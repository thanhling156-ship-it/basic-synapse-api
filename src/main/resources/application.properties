# ==============================================================
# 1. CẤU HÌNH SERVER & APP
# ==============================================================
spring.application.name=spaced-repetition-api
server.port=8080

# Key bảo mật cho JWT
jwt.secret=DayLaMotChuoiBiMatSieuCapVipProCuaSynapseProject2026

# ==============================================================
# 2. CẤU HÌNH DATABASE (POSTGRESQL + PGVECTOR)
# ==============================================================
spring.datasource.url=jdbc:postgresql://localhost:5432/synapse_api_db
spring.datasource.username=postgres
spring.datasource.password=123456
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ==============================================================
# 3. CẤU HÌNH SPRING AI & GOOGLE GEMINI
# ==============================================================
# Kích hoạt toàn diện Google GenAI
spring.ai.google.genai.project-id=gen-lang-client-0142060014
spring.ai.google.genai.enabled=true
spring.ai.google.genai.api-key=AIzaSyDI6iQFeqwDI6LFakgAHx5VMwxjFlStPTs
# --- Cấu hình Chat Model ---
# Lưu ý: Nên dùng gemini-1.5-flash hoặc gemini-2.0-flash để đảm bảo ổn định
spring.ai.google.genai.chat.options.model=gemini-2.5-flash-lite
spring.ai.google.genai.chat.options.temperature=0.0

# Đăng ký các hàm (Tools) để Gemini có thể gọi tự động
spring.ai.google.genai.chat.options.functions=studyAndSync

# --- Cấu hình Embedding (Dành cho pgvector) ---
# Kích hoạt đúng Key mà mã nguồn AutoConfiguration yêu cầu
spring.ai.model.embedding.text=google-genai
spring.ai.google.genai.embedding.enabled=true
spring.ai.google.genai.embedding.options.model=text-embedding-004

# --- Cấu hình Vector Store (PostgreSQL) ---
spring.ai.vectorstore.pgvector.initialize-schema=true
spring.ai.vectorstore.pgvector.index-type=hnsw

# Cho phép ghi đè Bean nếu cần thiết
spring.main.allow-bean-definition-overriding=true

# --- Hệ thống Agent "Thiết quân luật" ---
spring.ai.google.genai.chat.options.system-prompt=\
  BẠN LÀ AGENT TỰ PHỤC HỒI CỦA HỆ THỐNG SYNAPSE. \n\n\
  QUY TRÌNH THỰC THI LIÊN HOÀN: \n\
  1. Khi nhận lệnh 'hoàn thành/xong/thuộc', bạn BẮT BUỘC gọi 'searchFlashcardPremium' để lấy ID. \n\
  2. Dùng ID tìm được để gọi 'processStudyResult' với isCorrect=true. \n\
  3. Nếu hàm báo lỗi không tìm thấy ID, bạn PHẢI tự động search lại và thử lại một lần nữa. \n\n\
  NGHIÊM CẤM: Không giải thích văn bản khi đang thực hiện luồng gọi hàm. Chỉ báo cáo sau khi đã cập nhật thành công.

# ==============================================================
# 4. CẤU HÌNH LOGGING (DEBUG)
# ==============================================================
logging.level.org.springframework.ai=DEBUG
logging.level.org.hibernate.SQL=DEBUG